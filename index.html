<!DOCTYPE html>
<html>
<head>
<style>
html, body {
  overflow-x: hidden;
  height: 100%;
}
* {
  margin: 0;
  width: 100%;
  height: 100%;
}
*, *:before, *:after {
  box-sizing: border-box;
}
tr, tr * {
  height: auto;
}
td {
  padding: 1em;
}
</style>
</head>
<body>
<div id="ytplayer">
<table>
 <tr>
  <td colspan=2><h1>Show a YouTube video with Subtiles enabled</h1></td>
 </tr>
 <tr>
  <td>
   <form id="form">
     <input id="yt" type="text" name="yt" />
   </form>
  </td>
  <td style="width: auto;">YouTube&nbsp;URL&nbsp;/&nbsp;Video&nbsp;ID&nbsp;/&nbsp;etc</td>
 </tr>
 <tr>
  <td colspan=2></td>
 </tr>
</table>
</div>

<script>
  form.addEventListener('submit', function(event) {
    window.location.hash = yt_id(document.getElementById('yt').value);
    event.preventDefault();
  });

  function yt_id(url) {
    var yid = '';
    url = url.replace(/(>|<)/gi,'').split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);
    if (url[2] !== undefined) {
      yid = url[2].split(/[^0-9a-z_\-]/i);
      yid = yid[0];
    } else {
      yid = url[0];  // we'd split the string before
    }
    return yid;
  }

  // Replace the 'ytplayer' element with an <iframe> and
  // YouTube player after the API code downloads.
  var youtubeScript = null;
  var yid = null;
  var player = null;
  function onYouTubePlayerAPIReady() {
    console.log("onYouTubePlayerAPIReady()", yid);
    player = new YT.Player('ytplayer', {
       videoId: yid,
       playerVars: {
         autoplay: 1,        // Auto-play the video on load
         controls: 0,        // Show pause/play buttons in player
         showinfo: 0,        // Hide the video title
         modestbranding: 1,  // Hide the Youtube Logo
         loop: 1,            // Run the video in a loop
         fs: 0,              // Hide the full screen button
         cc_load_policy: 1,  // Hide closed captions
         cc_ars: 1,
         iv_load_policy: 1,  // Hide the Video Annotations
         hl: 'en',
         autohide: 0,        // Hide video controls when playing
       },
       events: {
         onReady: function(e) {
           e.target.loadModule("captions"); 
           e.target.mute();
         },
         onApiChange: function(e) {
           console.log(e.target.getOptions());
           console.log('captions', e.target.getOptions('captions'));
           e.target.setOption("captions", "track", {"languageCode": "en"}); 
           console.log('tracklist', e.target.getOption('captions', 'displaySettings'));
           e.target.setOption("captions", "fontSize", 3);
         },
       },
    });
  }

  function set_video(new_yid) {
    console.log('set_video', new_yid);
    yid = new_yid;

    if (player) {
      // already have a player, change what it's showing
      player.loadVideoById(yid);
    } else if (youtubeScript) {
      // script is loading but not ready yet, do nothing
    } else {
      // Load the IFrame Player API code asynchronously.
      youtubeScript = document.createElement('script');
      youtubeScript.src = "https://www.youtube.com/player_api";
      document.head.appendChild(youtubeScript);
    }
  }

  var hash = window.location.hash.substring(1);
  if (hash.length > 0) {
    set_video(yt_id(hash));
  }
  window.onhashchange = function() {
    hash = window.location.hash.substring(1);
    if (!hash) {
      // back to start
      window.location.reload();
    } else {
      set_video(yt_id(hash));
    }
  };

</script>


</body>
</html>
